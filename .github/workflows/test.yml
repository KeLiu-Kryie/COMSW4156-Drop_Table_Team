---
name: Test CI
on:
  push:
    branches:
      - main
      - CI-Testing
  pull_request:
    branches:
      - main
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
    - name: Configure GitHub SSH
      run: |
        mkdir -p ~/.ssh/
        echo "${{ secrets.ACTIONS_SSH_PRIVATE_KEY }}" > /home/runner/.ssh/id_rsa
        chmod 600 /home/runner/.ssh/id_rsa
        ssh-keyscan github.com >> ~/.ssh/known_hosts
        cat /home/runner/.ssh/known_hosts
    - name: Install dependencies
      run: |
        mkdir tessdata && export TESSDATA_PREFIX=$(pwd)/tessdata/ && git clone git@github.com:tesseract-ocr/tessdata_fast.git $(pwd)/tessdata/
    - name: Run tests
      run: |
        cd test
        sudo ./installGtest.sh
        ./runGtest.sh
